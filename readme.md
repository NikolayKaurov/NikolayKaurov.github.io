# 2 этап обучения MetaLamp

## Развёртывание и запуск

После клонирования репозитория необходимые пакеты устанавливаются стандартной
командой `npm install`. Сборка проекта запускается командой `npm run build`.

Исходными файлами для проекта являются шаблоны страниц в формате `.pug` в
папке `pages`. Каждый шаблон `.pug` из папки `pages` в процессе сборки транслируется в файл
`.html` в папке `dist`, кроме файла `index.pug` (список страниц), который транслируется в корневую папку
проекта, чтобы автоматически открываться по ссылке https://nikolaykaurov.github.io/.
Для публикации страниц макета достаточно скопировать содержимое папки
`dist` в папку сайта и указать в настройках сервера главную страницу,
например `Landing page.html`, либо просто переименовать одну из страниц из папки
`dist` в `index.html`. Пример такой публикации: https://toxin.h1n.ru/.

## Архитектура

Исходным файлом для каждой страницы в папке `dist` с готовыми страницами
является шаблон `.pug` из папки `pages`. В шаблонах используются БЭМ-блоки
из папки `blocks`.

Для папки `blocks` использована классическая файловая 
структура `nested` https://ru.bem.info/methodology/filestructure/#%D1%81%D1%85%D0%B5%D0%BC%D1%8B.
- Блоку соответствует одна директория
- Код модификаторов и элементов находится в отдельных файлах
- Файлы модификаторов и элементов хранятся в отдельных директориях
- Директория блока является корневой для поддиректорий его элементов и модификаторов
- Имена директорий элементов начинаются с двойного подчеркивания
- Имена директорий модификаторов начинаются с одинарного подчеркивания

Перед запуском `webpack` для каждого шаблона страницы заново генерируются
и перезаписываются заголовки вида `include ../blocks/block-dir/block-name`,
чтобы для каждой используемой в шаблоне БЭМ-сущности (блока, элемента или
модификатора), если у неё есть `mixin`, был корректно записан заголовок.
Аналогично, для каждого шаблона страницы генерируются заголовки вида
`@use 'blocks/block-dir/block-name';`; если у используемой в шаблоне БЭМ-сущности
есть файл стиля, соответствующий заголовок будет записан в файл
`pages/имя-шаблона.scss`. Файлы `.scss` в папке `pages` содержат только заголовки,
соответствующие используемым в шаблоне БЭМ-сущностям и один дополнительный
заголовок, подключающий файл с правилами `@font-face`.
Точно так же генерируются файлы `pages/имя-шаблона.js`. Если у используемой
в шаблоне БЭМ-сущности есть файл `javascript`, в файл `pages/имя-шаблона.js`
будет добавлен заголовок вида `import '../blocks/block-dir/block-name';`.
Дополнительно в каждый файл `pages/имя-шаблона.js` записываются два заголовка,
один для подключения иконок `import '../favicons/favicons';`, второй для
подключения файла стилей `import './имя-шаблона.scss';`. Данная генерация
заголовков выполняется функцией `preprocessor(pages, blocks)`, которая вызывается
в `webpack.config.js`.

Каждый файл `pages/имя-шаблона.js` является точкой входа для `webpack` и транслируется
в файл `dist/имя-шаблона.js`, содержащий весь требуемый для данной страницы
код `javascript`. Каждый шаблон `pages\имя-шаблона.pug` транслируется в
страницу `dist\имя-шаблона.html` при помощи `HtmlWebpackPlugin`. К каждой
странице подключаются только соответствующий ей файл `dist/имя-шаблона.js` и
файл `dist/jquery.js`. При помощи `MiniCssExtractPlugin` каждый файл 
`pages/имя-шаблона.scss` транслируется в `dist/имя-шаблона.css`.



